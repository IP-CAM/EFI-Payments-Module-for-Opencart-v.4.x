{% for style in styles %}
    <script>
    
        if (!document.querySelector('link[href="{{ style.href }}"]')) {
            let link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = "{{ style.href }}";
            document.head.appendChild(link);
        }
    </script>
{% endfor %}

<form class="container p-3 border border-1" id="efi-pix-form">
    <div class="row justify-content-center">
        <img src="{{ img_logo_url }}" class="img-fluid col-lg-3 col-md-5 col-7" alt="...">
    </div>

    <div class="row text-center mb-4">
        <strong class="fs-5">
            Optando por pagar através do pix, a confirmação será feita nos próximos segundos
        </strong>
    </div>

    <div class="row justify-content-between">
        {% for input in inputs %}
            <div class="mb-3 col-12 col-lg-6">
                <label for="{{ input.name }}" class="form-label fw-bold">
                    {{ input.label }}
                    {% if input.required %}
                        <span class="text-danger">*</span>
                    {% endif %}
                </label>
                <input type="{{ input.type }}" name="{{ input.name }}" id="{{ input.name }}"
                    class="form-control"
                    {% if input.required %} required {% endif %}
                    {% if input['data-mask'] %} data-mask="{{ input['data-mask'] }}" {% endif %}>
            </div>
        {% endfor %}
    </div>

    <div class="row justify-content-end">
        <div class="col">
            <div class="row justify-content-end">
                <div class="col">
                    <button type="button" id="button-confirm" class="btn text-white w-100">
                        <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        <span id="txt-">{{ btn_confirm_text_pix }}</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
    function loadScripts(scriptList, callback) {
        let index = 0;

        function loadNext() {
            if (index < scriptList.length) {
                // Verifica se o script já foi carregado antes de adicionar
                if (!document.querySelector(`script[src="${scriptList[index].href}"]`)) {
                    let script = document.createElement("script");
                    script.src = scriptList[index].href;
                    script.type = "text/javascript";
                    script.defer = true;

                    script.onload = () => {
                        index++;
                        loadNext();
                    };

                    document.body.appendChild(script);
                } else {
                    index++;
                    loadNext();
                }
            } else if (typeof callback === "function") {
                callback();
            }
        }

        loadNext();
    }

    // Carregar todos os scripts automaticamente caso não tenham sido carregados
    let scriptList = [
        {% for script in scripts %}
            { href: "{{ script.href }}" },
        {% endfor %}
    ];

    loadScripts(scriptList, () => {
        if (typeof MaskHandler !== 'undefined' && typeof CommonValidations !== 'undefined') {
            new MaskHandler();
            new PixFormHandler();
        }
    });
</script>

